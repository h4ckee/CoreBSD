#!/bin/sh
#
# /etc/rc.suspend: issue APM suspend event
#

syncmemory() {
	pidfile='/var/run/rc.suspend.pid'
	[ -r "$pidfile" ] && exit 1
	echo "$$" > "$pidfile"
	logger -t "$1" suspend at $(date +'%Y%m%d %H:%M:%S')
	sync && sync && sync
	sleep 3
	rm -f "$pidfile"
	return 0
}

case "$1" in
apm)	syncmemory; zzz ;;
acpi)	syncmemory; acpiconf -k 0 ;;
*)	echo "${0##*/} [apm|acpi]"; exit ;;
esac
